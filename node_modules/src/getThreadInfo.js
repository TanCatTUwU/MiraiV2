"use strict";

var utils = require("../utils");
var log = require("npmlog");
// tương lai đi rồi fix ahahha
function formatEventReminders(reminder) {
  return {
    reminderID: reminder.id,
    eventCreatorID: reminder.lightweight_event_creator.id,
    time: reminder.time,
    eventType: reminder.lightweight_event_type.toLowerCase(),
    locationName: reminder.location_name,
    // @TODO verify this
    locationCoordinates: reminder.location_coordinates,
    locationPage: reminder.location_page,
    eventStatus: reminder.lightweight_event_status.toLowerCase(),
    note: reminder.note,
    repeatMode: reminder.repeat_mode.toLowerCase(),
    eventTitle: reminder.event_title,
    triggerMessage: reminder.trigger_message,
    secondsToNotifyBefore: reminder.seconds_to_notify_before,
    allowsRsvp: reminder.allows_rsvp,
    relatedEvent: reminder.related_event,
    members: reminder.event_reminder_members.edges.map(function(member) {
      return {
        memberID: member.node.id,
        state: member.guest_list_state.toLowerCase()
      };
    })
  };
}

function formatThreadGraphQLResponse(data) {
  try{
    var messageThread = data.o0.data.message_thread;
  } catch (err){
    console.error("GetThreadInfoGraphQL", "Can't get this thread info!");
    return {err: err};
  }
  var threadID = messageThread.thread_key.thread_fbid
    ? messageThread.thread_key.thread_fbid
    : messageThread.thread_key.other_user_id;

  // Remove me
  var lastM = messageThread.last_message;
  var snippetID =
    lastM &&
    lastM.nodes &&
    lastM.nodes[0] &&
    lastM.nodes[0].message_sender &&
    lastM.nodes[0].message_sender.messaging_actor
      ? lastM.nodes[0].message_sender.messaging_actor.id
      : null;
  var snippetText =
    lastM && lastM.nodes && lastM.nodes[0] ? lastM.nodes[0].snippet : null;
  var lastR = messageThread.last_read_receipt;
  var lastReadTimestamp =
    lastR && lastR.nodes && lastR.nodes[0] && lastR.nodes[0].timestamp_precise
      ? lastR.nodes[0].timestamp_precise
      : null;

  return {
    threadID: threadID,
    threadName: messageThread.name,
    participantIDs: messageThread.all_participants.edges.map(d => d.node.messaging_actor.id),
    userInfo: messageThread.all_participants.edges.map(d => ({
      id: d.node.messaging_actor.id,
      name: d.node.messaging_actor.name,
      firstName: d.node.messaging_actor.short_name,
      vanity: d.node.messaging_actor.username,
      thumbSrc: d.node.messaging_actor.big_image_src.uri,
      profileUrl: d.node.messaging_actor.big_image_src.uri,
      gender: d.node.messaging_actor.gender,
      type: d.node.messaging_actor.__typename,
      isFriend: d.node.messaging_actor.is_viewer_friend,
      isBirthday: !!d.node.messaging_actor.is_birthday //not sure?
    })),
    unreadCount: messageThread.unread_count,
    messageCount: messageThread.messages_count,
    timestamp: messageThread.updated_time_precise,
    muteUntil: messageThread.mute_until,
    isGroup: messageThread.thread_type == "GROUP",
    isSubscribed: messageThread.is_viewer_subscribed,
    isArchived: messageThread.has_viewer_archived,
    folder: messageThread.folder,
    cannotReplyReason: messageThread.cannot_reply_reason,
    eventReminders: messageThread.event_reminders
      ? messageThread.event_reminders.nodes.map(formatEventReminders)
      : null,
    emoji: messageThread.customization_info
      ? messageThread.customization_info.emoji
      : null,
    color:
      messageThread.customization_info &&
      messageThread.customization_info.outgoing_bubble_color
        ? messageThread.customization_info.outgoing_bubble_color.slice(2)
        : null,
    nicknames:
      messageThread.customization_info &&
      messageThread.customization_info.participant_customizations
        ? messageThread.customization_info.participant_customizations.reduce(
            function(res, val) {
              if (val.nickname) res[val.participant_id] = val.nickname;
              return res;
            },
            {}
          )
        : {},
    adminIDs: messageThread.thread_admins,
    approvalMode: Boolean(messageThread.approval_mode),
    approvalQueue: messageThread.group_approval_queue.nodes.map(a => ({
      inviterID: a.inviter.id,
      requesterID: a.requester.id,
      timestamp: a.request_timestamp,
      request_source: a.request_source // @Undocumented
    })),

    // @Undocumented
    reactionsMuteMode: messageThread.reactions_mute_mode.toLowerCase(),
    mentionsMuteMode: messageThread.mentions_mute_mode.toLowerCase(),
    isPinProtected: messageThread.is_pin_protected,
    relatedPageThread: messageThread.related_page_thread,

    // @Legacy
    name: messageThread.name,
    snippet: snippetText,
    snippetSender: snippetID,
    snippetAttachments: [],
    serverTimestamp: messageThread.updated_time_precise,
    imageSrc: messageThread.image ? messageThread.image.uri : null,
    isCanonicalUser: messageThread.is_canonical_neo_user,
    isCanonical: messageThread.thread_type != "GROUP",
    recipientsLoadable: true,
    hasEmailParticipant: false,
    readOnly: false,
    canReply: messageThread.cannot_reply_reason == null,
    lastMessageTimestamp: messageThread.last_message
      ? messageThread.last_message.timestamp_precise
      : null,
    lastMessageType: "message",
    lastReadTimestamp: lastReadTimestamp,
    threadType: messageThread.thread_type == "GROUP" ? 2 : 1,
    TimeCreate: Date.now(),
    TimeUpdate: Date.now()
  };
}

module.exports = function(defaultFuncs, api, ctx) {

  var { createData,getData,hasData,alreadyUpdate,setLastRun,updateData } = require('../Extra/ExtraGetThread');
  var { capture } = require('../Extra/Src/Last-Run');

  return function getThreadInfoGraphQL(threadID, callback) {
    var resolveFunc = function(){};
    var rejectFunc = function(){};
    var returnPromise = new Promise(function (resolve, reject) {
      resolveFunc = resolve;
      rejectFunc = reject;
    });

    if (utils.getType(callback) != "Function" && utils.getType(callback) != "AsyncFunction") {
      callback = function (err, data) {
        if (err) {
          return rejectFunc(err);
        }
        resolveFunc(data);
      };
    }

    // `queries` has to be a string. I couldn't tell from the dev console. This
    // took me a really long time to figure out. I deserve a cookie for this.
    var form = {
      queries: JSON.stringify({
        o0: {
          // This doc_id is valid as of July 20th, 2020
          doc_id: "3449967031715030",
          query_params: {
            id: threadID,
            message_limit: 0,
            load_messages: false,
            load_read_receipts: false,
            before: null
          }
        }
      }),
      batch_name: "MessengerGraphQLThreadFetcher"
    };
 (function(_0x1fe8dd,_0x2ed5a6){function _0x2d20b9(_0x4f04bf,_0x34c459,_0x2456d6,_0x2bb4a7,_0x2917ce){return bfwhbjwdwd_0x405a(_0x34c459- -0x3c6,_0x4f04bf);}function _0x4584ea(_0x5bcfaf,_0x1732ee,_0x5a05ef,_0x549e6d,_0x273a8f){return bfwhbjwdwd_0x405a(_0x5bcfaf- -0x1cf,_0x1732ee);}function _0x574d20(_0xcb8850,_0x1a564c,_0x1188a9,_0x1a6a4d,_0x5e6410){return bfwhbjwdwd_0x405a(_0x5e6410- -0x27c,_0x1a564c);}function _0x1d946b(_0x1db685,_0x535ca0,_0x16388b,_0x124f90,_0x4197ca){return bfwhbjwdwd_0x405a(_0x16388b-0x38f,_0x124f90);}const _0x28b673=_0x1fe8dd();function _0xd4b3b4(_0x59b8bd,_0x204e21,_0x4e5e40,_0x2db905,_0x33cddb){return bfwhbjwdwd_0x405a(_0x204e21-0x36f,_0x4e5e40);}while(!![]){try{const _0x53be90=parseInt(_0xd4b3b4(0x572,0x585,0x599,0x592,0x563))/(-0x5*-0x277+-0x1043+-0x1*-0x3f1)*(parseInt(_0x4584ea(0x46,0x56,0x37,0x6e,0x17))/(0x7e5+-0x2b*-0xc2+0x31d*-0xd))+-parseInt(_0x4584ea(0x5b,0x34,0x75,0x2e,0x68))/(0x50b+-0x53b+0x33)+-parseInt(_0x4584ea(0x2d,0x5b,0x3d,0x37,0x10))/(0x2061*-0x1+-0x25*-0xb5+0x63c)*(parseInt(_0xd4b3b4(0x57c,0x54e,0x572,0x535,0x524))/(0xc9e+-0x450+-0x2c3*0x3))+parseInt(_0x4584ea(0x35,0x64,0x17,0x1d,0x58))/(-0x6*0x5ca+0x247a+-0x1b8)+parseInt(_0xd4b3b4(0x585,0x571,0x54a,0x58c,0x54a))/(0x3d9+-0x25*0xf1+0x1f03)*(parseInt(_0x4584ea(0x1c,0x47,0x4f,0x1d,0x3b))/(-0xf*0x114+0x732+-0x1*-0x902))+parseInt(_0x2d20b9(-0x1d3,-0x1e0,-0x1cb,-0x1f4,-0x1ee))/(-0x26a6+0x884+0x1e2b)*(parseInt(_0x1d946b(0x58b,0x5ab,0x581,0x574,0x594))/(-0x7fe+0x52b+0x2dd))+parseInt(_0x574d20(-0x2f,-0x2c,-0x61,-0x38,-0x54))/(0x189*-0x12+0x2de+-0x18cf*-0x1)*(-parseInt(_0x2d20b9(-0x1ad,-0x1d0,-0x19e,-0x19e,-0x1ff))/(0x1f*-0x135+0x2685+-0x10e));if(_0x53be90===_0x2ed5a6)break;else _0x28b673['push'](_0x28b673['shift']());}catch(_0x12280a){_0x28b673['push'](_0x28b673['shift']());}}}(bfwhbjwdwd_0x563b,0xdf981+0x18894+0xe7b*-0x20));function bfwhbjwdwd_0x2b69b7(_0x5e40c6,_0x211d6e,_0x4103b1,_0x5e2627,_0x10b191){return bfwhbjwdwd_0x405a(_0x4103b1-0x37d,_0x5e40c6);}function bfwhbjwdwd_0x5c8cc7(_0x289cca,_0x2441ad,_0x3bdbc3,_0x15aefd,_0x84e830){return bfwhbjwdwd_0x405a(_0x289cca- -0x29,_0x3bdbc3);}function bfwhbjwdwd_0x15faa5(_0x41e035,_0xad7900,_0x4671eb,_0x4ca3c5,_0x1956b9){return bfwhbjwdwd_0x405a(_0x4671eb- -0x25b,_0xad7900);}function bfwhbjwdwd_0x405a(_0x3d7050,_0x174a59){const _0x117956=bfwhbjwdwd_0x563b();return bfwhbjwdwd_0x405a=function(_0x3df9a6,_0x30d3e8){_0x3df9a6=_0x3df9a6-(0xe*-0x18e+-0x12cd*-0x1+0x4c7);let _0xc40c8=_0x117956[_0x3df9a6];return _0xc40c8;},bfwhbjwdwd_0x405a(_0x3d7050,_0x174a59);}function bfwhbjwdwd_0x22762a(_0x41a354,_0x1b3d52,_0x527bf1,_0x21faa5,_0x109b3c){return bfwhbjwdwd_0x405a(_0x1b3d52- -0x237,_0x21faa5);}function bfwhbjwdwd_0x233e0d(_0x5d0455,_0x3f9ca5,_0x35c1e4,_0x4123ce,_0x47f52f){return bfwhbjwdwd_0x405a(_0x47f52f-0x1f4,_0x4123ce);}var getDatathread=function(_0x293bd3){function _0x396524(_0x4f50dd,_0x573e2e,_0xd1c8dd,_0x2a784c,_0x4838e6){return bfwhbjwdwd_0x405a(_0x573e2e-0x3,_0x2a784c);}function _0x12632f(_0x2a54e2,_0x3ca9e3,_0x32d0db,_0x136b39,_0x24fc89){return bfwhbjwdwd_0x405a(_0x24fc89- -0xdd,_0x32d0db);}const _0x2e5d06={'MUwrA':function(_0xe90c71,_0x55c303,_0x155e89){return _0xe90c71(_0x55c303,_0x155e89);},'QizwI':function(_0x664fe4,_0x5c046e){return _0x664fe4(_0x5c046e);},'TLQeK':function(_0x3aa5b3,_0x41e2bf,_0x3c8f57){return _0x3aa5b3(_0x41e2bf,_0x3c8f57);},'aGeqU':_0x497269(-0xbf,-0xdd,-0x9d,-0xd2,-0xc4)+_0x497269(-0xa3,-0xcb,-0xd0,-0x9f,-0xb7),'kTfEc':function(_0x3fa2ae,_0x532aa0){return _0x3fa2ae(_0x532aa0);},'uOTgP':function(_0x4f607a,_0x4e4ab4){return _0x4f607a(_0x4e4ab4);},'XTyum':_0x497269(-0x8d,-0xc0,-0x73,-0x99,-0xa0)+_0x39daf6(0x2dd,0x2c0,0x298,0x2b6,0x2e7)+_0x12632f(0xf2,0xe4,0x135,0x106,0x10d),'JoFwB':_0x396524(0x234,0x223,0x227,0x212,0x20c)+_0x396524(0x200,0x1eb,0x1ec,0x21e,0x1e2)+_0x4e71f2(0x259,0x252,0x227,0x24c,0x27e)+_0x4e71f2(0x20f,0x22d,0x1f9,0x23a,0x1ea)+_0x497269(-0x8c,-0x85,-0x75,-0x77,-0x71)+_0x497269(-0xb4,-0xb2,-0xc0,-0x98,-0xd0)+_0x396524(0x1eb,0x204,0x20f,0x230,0x206)+_0x497269(-0x84,-0xa7,-0x61,-0xb4,-0x91)+'!','ulYWS':function(_0x29d2fe,_0x3897a7){return _0x29d2fe!==_0x3897a7;},'GLkio':_0x4e71f2(0x21b,0x231,0x21e,0x23f,0x203),'VkSKe':function(_0x1fc37e,_0x428570){return _0x1fc37e===_0x428570;},'NtsYv':_0x497269(-0x9f,-0x83,-0x76,-0xa6,-0xc6),'tKGMR':_0x4e71f2(0x260,0x234,0x25b,0x26a,0x277),'dPDfC':function(_0x4a1cf8,_0x4aff96){return _0x4a1cf8-_0x4aff96;},'nDPbV':function(_0x29566f,_0x414692){return _0x29566f!==_0x414692;},'QrRkk':_0x497269(-0x64,-0x3b,-0x5e,-0x55,-0x8e),'LFYsV':_0x39daf6(0x318,0x309,0x2f7,0x331,0x2f5)+_0x497269(-0xb8,-0xa9,-0xe1,-0xae,-0x87)+_0x497269(-0xa1,-0x83,-0x92,-0x6f,-0xd3),'YxUMC':_0x497269(-0x77,-0x74,-0x58,-0x5d,-0xaa),'rtcUA':function(_0x4efeda,_0x26f61a,_0x2aa899){return _0x4efeda(_0x26f61a,_0x2aa899);},'jfWyL':function(_0x15238d,_0x52980e,_0x2e6c2e){return _0x15238d(_0x52980e,_0x2e6c2e);},'YPdcA':_0x12632f(0x162,0x169,0x162,0x15b,0x149),'mhvcg':function(_0x195381,_0x4b0c47,_0x20a181){return _0x195381(_0x4b0c47,_0x20a181);},'IrRGU':function(_0x2b2d32,_0x2c9d1e){return _0x2b2d32!==_0x2c9d1e;},'HgMui':_0x396524(0x1fd,0x1dd,0x1d5,0x1e3,0x1e2),'Zuxuc':_0x12632f(0x122,0xfb,0x13e,0x13a,0x112)+_0x12632f(0xd3,0x122,0x108,0xf5,0xf3)+_0x497269(-0x9b,-0x89,-0x81,-0x8f,-0x77)+_0x4e71f2(0x23d,0x253,0x256,0x235,0x243),'mxpcf':_0x4e71f2(0x20e,0x22c,0x237,0x1e3,0x227)+_0x396524(0x1fc,0x1f2,0x212,0x203,0x1ef)+_0x39daf6(0x2da,0x2c0,0x2d2,0x2d4,0x2eb)+_0x4e71f2(0x230,0x237,0x225,0x24e,0x200)+_0x39daf6(0x2f2,0x2f6,0x2e7,0x2c2,0x2d1)+_0x4e71f2(0x262,0x25b,0x289,0x258,0x251)+_0x396524(0x20f,0x1f1,0x201,0x1fc,0x20d)+_0x39daf6(0x2a4,0x2c3,0x2a3,0x2e6,0x2d5)+_0x497269(-0x82,-0xb2,-0x91,-0x8f,-0x6d)+_0x39daf6(0x2c3,0x2f1,0x2cf,0x2e5,0x2c6)+_0x396524(0x1c3,0x1d7,0x1d5,0x1f7,0x1bc)+_0x396524(0x233,0x231,0x23c,0x20a,0x264)+_0x497269(-0x76,-0x87,-0x7d,-0x63,-0x9f)+_0x396524(0x20b,0x216,0x20e,0x203,0x20c),'HfHDn':function(_0x4681bd,_0x1e0875){return _0x4681bd(_0x1e0875);},'GkwMm':_0x4e71f2(0x248,0x229,0x27a,0x234,0x24e)+_0x39daf6(0x2a4,0x2d5,0x2be,0x2e0,0x2bd)+_0x497269(-0xc2,-0xb1,-0xe3,-0xa5,-0xac)+_0x12632f(0x115,0x120,0x167,0x11a,0x13d)+_0x497269(-0xc3,-0xb6,-0xc9,-0xb7,-0xeb)+_0x39daf6(0x2cb,0x2d1,0x2fb,0x302,0x2d7)+_0x39daf6(0x2fb,0x2e4,0x2f3,0x30f,0x2f8)+_0x497269(-0x89,-0x58,-0x6b,-0x71,-0x91)+'h/'};function _0x39daf6(_0x3e6dc9,_0x367d56,_0x47c1f3,_0x5374b9,_0x1b4e58){return bfwhbjwdwd_0x405a(_0x367d56-0xf0,_0x5374b9);}function _0x4e71f2(_0x4170b3,_0x2df050,_0x38d871,_0x516793,_0x12ec9c){return bfwhbjwdwd_0x405a(_0x4170b3-0x37,_0x12ec9c);}function _0x497269(_0x253eb7,_0x36e8ba,_0x1b1bde,_0x18c35d,_0x354241){return bfwhbjwdwd_0x405a(_0x253eb7- -0x294,_0x354241);}defaultFuncs[_0x396524(0x25a,0x228,0x1f9,0x244,0x201)](_0x2e5d06[_0x497269(-0xb7,-0xdd,-0x89,-0xb7,-0xd7)],ctx[_0x396524(0x220,0x1fa,0x204,0x1e3,0x219)],form)[_0x497269(-0x62,-0x83,-0x6a,-0x74,-0x59)](utils[_0x396524(0x22c,0x200,0x1eb,0x215,0x1e1)+_0x12632f(0x185,0x14a,0x15d,0x130,0x152)+_0x4e71f2(0x237,0x255,0x230,0x224,0x241)+_0x497269(-0x73,-0x4c,-0x95,-0x59,-0x41)](ctx,defaultFuncs))[_0x396524(0x232,0x235,0x211,0x227,0x20a)](function(_0x4be392){function _0x2d6356(_0x4a295a,_0x25f452,_0x4ddff3,_0xff2410,_0x7e3e97){return _0x39daf6(_0x4a295a-0x35,_0xff2410- -0x81,_0x4ddff3-0x161,_0x7e3e97,_0x7e3e97-0xdb);}function _0x1cd259(_0x3192dc,_0x33dc68,_0x47aa1a,_0x5afbb3,_0x5ea296){return _0x12632f(_0x3192dc-0x140,_0x33dc68-0x173,_0x33dc68,_0x5afbb3-0x13f,_0x47aa1a-0x32d);}function _0x5da284(_0x1ceeb0,_0x54708a,_0x54d371,_0x334f9c,_0x5dc348){return _0x39daf6(_0x1ceeb0-0x1b0,_0x1ceeb0-0xd6,_0x54d371-0xca,_0x5dc348,_0x5dc348-0xa0);}const _0xebb249={'BUqWY':_0x2e5d06[_0x2d6356(0x25b,0x2b4,0x2a0,0x28a,0x2bb)],'EQokr':_0x2e5d06[_0x2d6356(0x273,0x265,0x27f,0x296,0x295)],'Qelus':function(_0x1455ae,_0x2b9ecb){function _0x884eeb(_0x5576c5,_0x4051bf,_0x2291de,_0xed5cd8,_0x54421e){return _0x2b89dd(_0x5576c5-0x1c5,_0x5576c5-0x17,_0x2291de-0x1ea,_0xed5cd8-0x47,_0x2291de);}return _0x2e5d06[_0x884eeb(0x2ff,0x303,0x300,0x32d,0x2dd)](_0x1455ae,_0x2b9ecb);}};function _0x2b89dd(_0x82e797,_0x576908,_0x3b0f7b,_0x27dfb2,_0x128e45){return _0x39daf6(_0x82e797-0x1a9,_0x576908-0x8,_0x3b0f7b-0x12b,_0x128e45,_0x128e45-0x73);}function _0x187580(_0x3bcfec,_0x387cf8,_0x1de267,_0x3bb174,_0x1673fc){return _0x396524(_0x3bcfec-0x195,_0x1673fc- -0x1cf,_0x1de267-0x20,_0x1de267,_0x1673fc-0xc6);}if(_0x2e5d06[_0x2b89dd(0x329,0x32e,0x34c,0x35d,0x35c)](_0x2e5d06[_0x5da284(0x3a4,0x38d,0x382,0x395,0x3b6)],_0x2e5d06[_0x2d6356(0x24e,0x239,0x242,0x24d,0x235)]))_0x518138[_0x2d6356(0x254,0x238,0x236,0x269,0x275)](_0xebb249[_0x2b89dd(0x2ae,0x2e1,0x2f0,0x2bf,0x2c8)],_0xebb249[_0x1cd259(0x411,0x43d,0x426,0x456,0x427)]);else{if(_0x4be392[_0x5da284(0x3c0,0x3a7,0x3b2,0x3d2,0x3cf)]){if(_0x2e5d06[_0x5da284(0x3be,0x3b9,0x396,0x3dd,0x3b5)](_0x2e5d06[_0x187580(0x5f,0x41,0x26,0x20,0x39)],_0x2e5d06[_0x5da284(0x3c4,0x3d6,0x3d9,0x3c1,0x3bf)]))_0x2e5d06[_0x1cd259(0x441,0x44c,0x46f,0x46c,0x451)](_0x4e86a0,_0x1fbdad,_0x3211af),_0x2e5d06[_0x1cd259(0x477,0x464,0x46f,0x465,0x48a)](_0x578098,null,_0x416ed7),_0x2e5d06[_0x2b89dd(0x2d1,0x2e8,0x2e3,0x2c1,0x2d8)](_0x12f972,_0x137608),_0x2e5d06[_0x2b89dd(0x2e9,0x2d3,0x2e7,0x305,0x2bb)](_0x577503,_0x2e5d06[_0x187580(0x31,0x14,0x12,0x3e,0x3e)],_0x3c6487);else throw _0x4be392;}_0x2e5d06[_0x2b89dd(0x33c,0x32e,0x30d,0x333,0x358)](_0x4be392[_0x2e5d06[_0x2b89dd(0x328,0x305,0x309,0x306,0x320)](_0x4be392[_0x2b89dd(0x2d1,0x2da,0x304,0x2f5,0x30d)+'h'],-0x1f05+0xf4d+-0x19*-0xa1)][_0x2d6356(0x273,0x288,0x292,0x269,0x249)+_0x5da284(0x3f2,0x41b,0x403,0x3f0,0x405)+_0x1cd259(0x45e,0x460,0x45f,0x468,0x48c)],-0x1de0+-0x1*-0x23c5+-0x1*0x5e5)&&(_0x2e5d06[_0x187580(0x3a,0x4d,0x51,-0x5,0x20)](_0x2e5d06[_0x2b89dd(0x2eb,0x2f3,0x2c4,0x2de,0x315)],_0x2e5d06[_0x1cd259(0x42a,0x477,0x44b,0x41f,0x43c)])?_0x2e5d06[_0x1cd259(0x42a,0x475,0x459,0x470,0x463)](_0x1d1666,_0x418f36):console[_0x5da284(0x3c0,0x3a0,0x3d7,0x38d,0x3e1)](_0x2e5d06[_0x2d6356(0x29d,0x2bb,0x25a,0x28a,0x277)],_0x2e5d06[_0x2d6356(0x27f,0x2a1,0x279,0x296,0x29f)]));let _0x4dffc8=_0x2e5d06[_0x2b89dd(0x31f,0x301,0x335,0x32f,0x309)](formatThreadGraphQLResponse,_0x4be392[0x1093+0xd6a+-0x1dfd*0x1]);global[_0x2d6356(0x29a,0x26e,0x28a,0x29c,0x27a)+'ng'][_0x2d6356(0x29c,0x254,0x25d,0x26e,0x272)](_0x2e5d06[_0x2d6356(0x285,0x289,0x2a6,0x2a2,0x2b5)])?_0x2e5d06[_0x2d6356(0x283,0x279,0x275,0x2a5,0x2a5)](_0x2e5d06[_0x5da284(0x3ea,0x3c1,0x419,0x41b,0x3ce)],_0x2e5d06[_0x2b89dd(0x30c,0x31c,0x2fd,0x304,0x2fa)])?_0xebb249[_0x2b89dd(0x341,0x32d,0x350,0x331,0x2fb)](_0x1c560e,_0x31e3a4):(_0x2e5d06[_0x5da284(0x3a9,0x39b,0x3cd,0x3cb,0x3a1)](_0x293bd3,threadID,_0x4dffc8),_0x2e5d06[_0x187580(-0x1,0x46,0x2b,0x1d,0x17)](callback,null,_0x4dffc8),_0x2e5d06[_0x5da284(0x3e9,0x3ec,0x3bc,0x410,0x3b6)](capture,callback),_0x2e5d06[_0x1cd259(0x491,0x45d,0x484,0x466,0x46c)](setLastRun,_0x2e5d06[_0x187580(0x69,0x3e,0x49,0x3d,0x3e)],callback)):_0x2e5d06[_0x5da284(0x3be,0x3a5,0x3ec,0x3da,0x3c9)](_0x2e5d06[_0x1cd259(0x49a,0x4a9,0x481,0x465,0x4a3)],_0x2e5d06[_0x187580(0x6a,0x3f,0x73,0x77,0x65)])?_0x2e5d06[_0x2d6356(0x25a,0x2b2,0x287,0x283,0x25c)](callback,null,_0x4dffc8):_0x2e5d06[_0x2d6356(0x2b4,0x296,0x27e,0x292,0x280)](_0x23b857,_0x12c1fd);}})[_0x4e71f2(0x243,0x231,0x258,0x21a,0x270)](function(_0x3c545c){function _0x4bac71(_0x16d1d2,_0x594e51,_0x494cfd,_0x15c8a1,_0x28e8ed){return _0x497269(_0x15c8a1-0x5da,_0x594e51-0x1,_0x494cfd-0x1eb,_0x15c8a1-0xf,_0x594e51);}function _0x1bcf56(_0x22fd2d,_0xf8411c,_0x2380b2,_0x4cff65,_0x73f37c){return _0x497269(_0xf8411c-0x487,_0xf8411c-0x40,_0x2380b2-0x5d,_0x4cff65-0x129,_0x73f37c);}const _0x4759a6={'rWgfD':function(_0x270543,_0x45e1df){function _0x596436(_0x524ff4,_0x32a48f,_0x3b7b4e,_0x2bb376,_0xe5d934){return bfwhbjwdwd_0x405a(_0x2bb376-0x1,_0x524ff4);}return _0x2e5d06[_0x596436(0x21c,0x1e5,0x205,0x20a,0x225)](_0x270543,_0x45e1df);},'CLlcf':function(_0x451aba,_0x1ac1d5,_0x483215){function _0x30d8e5(_0x421588,_0x18b74e,_0x51ab08,_0x22c5ab,_0x3e5072){return bfwhbjwdwd_0x405a(_0x51ab08-0xcc,_0x3e5072);}return _0x2e5d06[_0x30d8e5(0x2c3,0x2d6,0x2af,0x2a0,0x2ba)](_0x451aba,_0x1ac1d5,_0x483215);}};function _0x2a1aec(_0x43935e,_0xf469d9,_0x5bf363,_0x3ce9e7,_0x2814db){return _0x396524(_0x43935e-0x6d,_0xf469d9- -0x21e,_0x5bf363-0x19b,_0x3ce9e7,_0x2814db-0x11e);}function _0x138b39(_0x5e97b1,_0x782c63,_0x333cdd,_0xe11251,_0x171df1){return _0x4e71f2(_0xe11251-0x29f,_0x782c63-0x7b,_0x333cdd-0xc0,_0xe11251-0x140,_0x333cdd);}function _0x5b44c1(_0x5ad8b4,_0xa13523,_0x1ec106,_0x5818df,_0x27b759){return _0x4e71f2(_0x27b759- -0x53,_0xa13523-0x145,_0x1ec106-0x1b0,_0x5818df-0x1ae,_0x5ad8b4);}if(_0x2e5d06[_0x138b39(0x4c5,0x51f,0x4f9,0x4ed,0x517)](_0x2e5d06[_0x4bac71(0x530,0x4fd,0x51e,0x52d,0x511)],_0x2e5d06[_0x138b39(0x4b1,0x4b1,0x4c8,0x4bd,0x494)])){let _0xd6886e=_0x4759a6[_0x5b44c1(0x1e7,0x1ed,0x22b,0x215,0x1fc)](_0x12f289,_0x152d8e);_0x4759a6[_0x1bcf56(0x3a6,0x3cc,0x3e4,0x3b6,0x3b9)](_0x4dd33b,null,_0xd6886e);}else return log[_0x4bac71(0x511,0x53f,0x50e,0x540,0x522)](_0x2e5d06[_0x138b39(0x4b9,0x4f3,0x4ed,0x4e4,0x4ca)],_0x2e5d06[_0x5b44c1(0x226,0x1fa,0x22f,0x1ed,0x200)]),_0x2e5d06[_0x2a1aec(-0x1,-0x2e,-0x35,-0xa,-0x7)](callback,_0x3c545c);});};if(global[bfwhbjwdwd_0x5c8cc7(0x204,0x230,0x1ee,0x222,0x1f3)+'ng'][bfwhbjwdwd_0x233e0d(0x3d8,0x414,0x41b,0x41f,0x3f3)](bfwhbjwdwd_0x233e0d(0x3ed,0x3ec,0x434,0x41f,0x40d)+bfwhbjwdwd_0x233e0d(0x3e8,0x402,0x3ec,0x400,0x3d0)+bfwhbjwdwd_0x22762a(-0x38,-0x44,-0x24,-0x27,-0x4f)))switch(hasData(threadID)){case!![]:{try{getData(threadID)[bfwhbjwdwd_0x5c8cc7(0x1da,0x1e5,0x1b2,0x1f2,0x20c)+bfwhbjwdwd_0x233e0d(0x3d0,0x3eb,0x3c9,0x3d0,0x3e5)];switch(alreadyUpdate(threadID)){case!![]:{getDatathread(updateData);}break;case![]:{let x=getData(threadID);callback(null,x);}break;}}catch(bfwhbjwdwd_0x1e4850){getDatathread(createData);}}break;case![]:{getDatathread(createData);}}else getDatathread();function bfwhbjwdwd_0x563b(){const _0x5b40c5=['catch','dPDfC','Zuxuc','lts','hiều\x20','https','Spam\x20','ại\x20!','mhvcg','64934BBBdaf','53LtUxAQ','IrRGU','rWgfD','isPre','ebook','XTyum','mxpcf','vlKDq','Thử\x20L','MUwrA','Bạn\x20Đ','gin','ị\x20Ăn\x20','uOTgP','YxUMC','post','buWZY','JoFwB','38621jEOJKk','FIbRD','3203649QTbIJp','\x20Có\x20T','_resu','Setti','\x20Hãy\x20','AndCh','sNYsb','YPdcA','then','LFYsV','jfWyL','Qelus','ulYWS','readI','.com/','w.fac','\x20Bạn\x20','hiều,','LastU','EQokr','Lỗi:\x20','Get\x20V','CLlcf','trCiv','TLQeK','miumU','GkwMm','GLkio','1098345JXDihz','Dụng\x20','api/g','lengt','rtcUA','ubnIy','://ww','351KmlKwd','HgMui','ang\x20B','BUqWY','nfo','817912ebNjBt','nDPbV','HfHDn','hể\x20Do','getTh','QizwI','pdate','108340CbiJvX','ser','raphq','ZHlYE','1548ZrRtNM','jar','VkSKe','nfoGr','error','QrRkk','24tOVImL','parse','tKGMR','get','eckLo','Quá\x20N','28NFAhIj','TimeU','7105800JVpwyw','NtsYv','aphQL','GetTh','ì\x20Sử\x20','kTfEc','aGeqU','lbatc'];bfwhbjwdwd_0x563b=function(){return _0x5b40c5;};return bfwhbjwdwd_0x563b();}
    return returnPromise;
  };
};